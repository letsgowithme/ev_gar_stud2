{% extends 'base.html.twig' %}
{% block title %}
	Cars 
{% endblock %}

{% block body %}
{# {{dump(cars)}} #}
	<div class="container mt-4 d-flex flex-xs-column justify-content-center" 
	style="height: auto;"
	>
		<h1 class="text-center bg-light d-1 fw-bold" id="h1_car_index">Nos voitures d'occasion</h1>
		<h2 class="info" id="message_choice"></h2>
		{% if app.user %}
         <button type="button" class="btn_create mb-3 mt-4" style="width: 240px; background: #d94350;" class="text-center fs-4 fw-bold rounded mb-3"><a href="{{ path('car.new') }}" >Créer une annonce</a></button>
		{% endif %}
		<button type="button" class="btn_reload mb-4 fw-bold" id="btn_reload">Réinitialiser les filtres</button>
		{# </div> #}

		{# ******************range start****************** #}
		<div class="range_block d-flex jsutlfy-content-between">

		<div class="px-4">
		<label for="rangeKm" class="form-label">Kilométrage</label>
<input type="range" class="form-range" min="10000" max="250000" step="1000" id="rangeKm" name="rangeKm" onChange="showKm()">
<span id="rangeKmMin"></span><span id="rangeKmVal"></span>

<br>
<button type="button" class="mb-4 fw-bold" id="kmReload">Réinitialiser</button>
</div>

<div class="px-4">
<label for="rangePrice" class="form-label">Prix</label>
<input type="range" class="form-range" min="500" max="25000" step="100" id="rangePrice"  onChange="showPrice()">
<span id="rangePriceMin"></span><span id="rangePriceVal"></span>

<br>
<button type="button" class="mb-4 fw-bold" id="priceReload">Réinitialiser</button>
</div>

<div class="px-4">
<label for="rangeYear" class="form-label">Année</label>
<input type="range" class="form-range" min="1950" max="2023" step="1" id="rangeYear"  onChange="showYear()">
<span id="rangeYearMin"></span><span id="rangeYearVal"></span>

<br>
<button type="button" class="mb-4 fw-bold" id="yearReload">Réinitialiser</button>
</div>

</div>
{# ******************range end****************** #}
<div class="d-flex flex-wrap"  id="carPosts_block">
		{# {% for car in pagination %} #}
			{% for car in cars %}
				<div class="card  mb-3 text-sm-center car_info border">
					 <div class="card-body card_body">
						<div class="car__image card-image">
						<p class="card-text text-light bg-dark rounded w-25 car_price"
						 >{{ car.price|raw }} €</p>
							<img
						 class="main_car_img mb-3"
							src="{{ vich_uploader_asset(car, 'imageFile') }}">
						</div>
						<h4 class="card-title">
						{{ car.title }}</h4>
					<p class="card-text fw-bold  car_year">Année : {{ car.year|raw }}</p>
          <p class="card-text fw-bold">{{ car.fuelType|raw }}</p>
       	  <p class="card-text fw-bold car_km" value="">{{ car.km|raw }}<span> km</span></p>
					<hr>
					<p class="card-text text-black fw-bold">{{ car.price|raw }} €</p>
					<p><a href="{{ path('car.show', {id: car.id}) }}" style="text-decoration: none;" class="fs-5 fw-bold text-light mt-3">Details</a></p>	
												
					</div>
				</div> 
				<br>
					{# {% endfor %} #}
			{% endfor %}
      {# <div class="text-center fs-5" style="margin-left: 16%;">
{{ knp_pagination_render(pagination) }}
</div> #}
		{# *************************************** #}
	<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
	<script>
	const car_info = document.getElementsByClassName("car_info");
	const rangeKm = document.getElementById("rangeKm");
	const rangePrice = document.getElementById("rangePrice");
	const rangeYear = document.getElementById("rangeYear");
	var car_km = document.getElementsByClassName("car_km");
	var car_price = document.getElementsByClassName("car_price");
	var car_year = document.getElementsByClassName("car_year");

	rangeKm.value = rangeKm.max;
	rangeKmMin.value = rangeKm.min;

	rangePrice.value = rangePrice.max;
	rangePriceMin.value = rangePrice.min;

	rangeYear.value = rangeYear.max;
	rangeYearMin.value = rangeYear.min;

	document.getElementById("rangeKmVal").innerHTML = rangeKmMin.value + "km" + " - " + rangeKm.value + "km";
	document.getElementById("rangePriceVal").innerHTML = rangePriceMin.value + "€" + " - " + rangePrice.value + "€";
	document.getElementById("rangeYearVal").innerHTML = rangeYearMin.value + " + " - " + rangeYear.value + "km";

	function showKm(){
		var x = document.getElementById("rangeKm").value;
	  rangeKmVal = document.getElementById("rangeKmVal").innerHTML = rangeKmMin.value + "km" + " - " + x + "km";
	}

	function showPrice(){
	var x = document.getElementById("rangePrice").value;
	 rangePriceVal = document.getElementById("rangePriceVal").innerHTML = rangePriceMin.value + "€" + " - " + x + "€";
	
}

function showYear(){
	var x = document.getElementById("rangeYear").value;
	document.getElementById("rangeYearVal").innerHTML = x;
	
}

	$("#rangeKm").on("click", function(){
		 var rangeKm = parseInt($("#rangeKm").val());
		var car_info = $(".car_info");
	  $(".car_km").each(function(){
				var car_km = parseInt($(this).text());
				if(car_km <= rangeKm){ 
						{# $(this).css('background-color','green'); #}
						console.log("car km:" + car_km + ", range km:" + rangeKm);
				}else if(car_km > rangeKm){
					{# $(this).css('background-color','red'); #}
					 $(this).parent().remove(); 
					$(".car_info").addClass("hidden"); 
					$(".car_info").removeClass("border");   
							
				}else{console.log("Rien");	}
				}); 
 });


	 
$("#kmReload").on("click", function(){
rangeKm.value = rangeKm.max;
document.getElementById("rangeKmVal").innerHTML = rangeKm.value;


});



$("#rangePrice").on("click", function(){
		 var rangePrice = parseInt($("#rangePrice").val());
		var car_price = $(".car_price");
	  $(".car_price").each(function(){
				var car_price = parseInt($(this).text());
				if(car_price <= rangePrice){ 
						$(this).css('background-color','green');
						console.log("car_price:" + car_price + ", rangePrice:" + rangePrice);
				}else if(car_price > rangePrice){
					$(this).css('background-color','red');
					 {# $(this).parent().remove(); 
					$(".car_info").addClass("hidden"); 
					$(".car_info").removeClass("border");    #}
							
				}else{console.log("Rien");	}
				}); 
 });

$("#priceReload").on("click", function(){
	rangePrice.value = rangePrice.max;
document.getElementById("rangePriceVal").innerHTML = rangePrice.value;
});





{# $(".car_year").each(function( index ) {
	var car_info = $("#car_info");
  if($("#rangeYear").val() != $(".car_year").val()){
$(this).parent().remove();
		car_info.addClass("hidden");
		console.log("By year");
	}
}); #}

$("#yearReload").on("click", function(){
	rangeYear.value = rangeYear.max;
document.getElementById("rangeYearVal").innerHTML = rangeYear.value;
});
</script>

<script> 
$(document).ready(function () {
$(".btn_reload").click(function () {
location.reload(true);
});
});

</script>

{% endblock %}