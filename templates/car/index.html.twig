{% extends 'base.html.twig' %}
{% block head %}
	<link rel="stylesheet" href="{{ asset('assets/css/jquery-ui.min.css') }}">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.2/jquery.modal.min.css" integrity="sha512-T3VL1q6jMUIzGLRB9z86oJg9PgF7A55eC2XkB93zyWSqQw3Ju+6IEJZYBfT7E9wOHM7HCMCOZSpcssxnUn6AeQ==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
{% endblock %}
{% block title %}
	Voitures 
{% endblock %}
	
{% block body %}
	<div class="container mt-4 d-flex flex-xs-column justify-content-center" 
	style="height: auto;"
	>
		<h1 class="text-center bg-light d-1 fw-bold" id="h1_car_index">Nos voitures d'occasion</h1>
		<h2 class="info" id="message_choice"></h2>
		{% if app.user %}
         <button type="button" class="btn_create mb-3 mt-4" style="width: 240px; background: #d94350;" class="text-center fs-4 fw-bold rounded mb-3"><a href="{{ path('car.new') }}" >Créer une annonce</a></button>
		{% endif %}
		<button type="button" class="btn_reload mb-4 fw-bold" id="btn_reload">Réinitialiser les filtres</button>
		{# </div> #}

		{# ******************range start****************** #}
		<div class="range_block d-flex justify-content-between">

		<div class="px-4">
		<label for="rangeKm" class="form-label fw-bold">Kilométrage</label>
<input type="range" class="form-range" min="10000" max="250000" step="500" id="rangeKm" name="rangeKm"  
{# onChange="showKm()" #}
>
<div class="fw-bold">
<span id="rangeKmMin"></span><span id="rangeKmVal"></span>
</div>

<br>
<button type="button" class="mb-4 fw-bold" id="kmReload">Réinitialiser</button>
</div>

<div class="px-4">
<label for="rangePrice" class="form-label fw-bold">Prix</label>
<input type="range" class="form-range" min="500" max="30000" step="100" id="rangePrice" width="300px;">
<div class="fw-bold">
<span id="rangePriceMin"></span><span id="rangePriceVal"></span>
</div>
<br>
<button type="button" class="mb-4 fw-bold" id="priceReload">Réinitialiser</button>
</div>

<div class="px-4">
<label for="rangeYear" class="form-label fw-bold">Année</label>
<input type="range" class="form-range" min="1950" max="2023" step="1" id="rangeYear">
<div class="fw-bold">
<span id="rangeYearMin" ></span><span id="rangeYearVal"></span>
</div>
<br>
<button type="button" class="mb-4 fw-bold" id="yearReload">Réinitialiser</button>
</div>

</div>

{# ******************range end****************** #}
<div class="d-flex flex-wrap text-center"  id="carPosts_block">
		{# {% for car in pagination %} #}
			{% for car in cars %}
				<div class="card-body mb-3 text-xs-center car_info border rounded mx-3"
				style="display: block;">
						<div class="car__image card-image">
						<p class="card-text text-light bg-dark rounded w-25 car_price_span"
						 >{{ car.price|raw }} €</p>
							<img
						 class="main_car_img mb-3"
							src="{{ vich_uploader_asset(car, 'imageFile') }}">
						</div>
						<h4 class="card-title">
						{{ car.title }}</h4>
					<span class="fs-2">Année : </span><p class="card-text fw-bold  car_year" value=""> {{ car.year|raw }}</p>
          <p class="card-text fw-bold">{{ car.fuelType|raw }}</p>
       	  <p class="card-text fw-bold car_km" value="">{{ car.km|raw }}<span> km</span></p>
					<hr>
					<p class="card-text text-black fw-bold car_price" value="">{{ car.price|raw }}<span> €</span></p>
					<p><a href="{{ path('car.show', {id: car.id}) }}" style="text-decoration: none;" class="fw-bold text-light mt-3 link_details">Details</a></p>	
												
					</div>
			
				<br>
					{% endfor %}
			{# {% endfor %} #}
      {# <div class="text-center fs-5" style="margin-left: 16%;">
{{ knp_pagination_render(pagination) }}
</div> #}

</div>
<div class="row mt-4 mb-4">
			<div class="col-12">
				{% include "partials/_btn_up.html.twig" %}
				{% include "partials/_btn_home.html.twig" %}
			</div>
		</div>
</div>
	
<div class="row mt-4">
			<div class="col-12">
				{% include "partials/_liens_schedule_address.html.twig" %}
			</div>
		</div>
		{# *************************************** #}
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js">
</script>
	<script>	
	const rangeKm = document.getElementById("rangeKm");
	const rangePrice = document.getElementById("rangePrice");
	const rangeYear = document.getElementById("rangeYear");
	

	rangeKm.value = rangeKm.max;
	rangeKmMin.value = rangeKm.min;

	rangePrice.value = rangePrice.max;
	rangePriceMin.value = rangePrice.min;

	rangeYear.value = rangeYear.max;
	rangeYearMin.value = rangeYear.min;
</script>
	<script>	
$(document).ready(function () {
		$(".car_info").addClass("visible"); 
		
  var rangeKmMin = $("#rangeKm").attr('min');
	var rangeKmMax = $("#rangeKm").attr('max');
	$("#rangeKmVal").text(rangeKmMin + " km" +  " - " + rangeKmMax + "km");

  var rangePriceMin = $("#rangePrice").attr('min');
	var rangePriceMax = $("#rangePrice").attr('max');
	$("#rangePriceVal").text(rangePriceMin + "€" +  " - " + rangePriceMax + "€");

  var rangeYearMin = $("#rangeYear").attr('min');
	var rangeYearMax = $("#rangeYear").attr('max');
	$("#rangeYearVal").text(rangeYearMin +  " - " + rangeYearMax);

 function kmChoice(){
		var rangeKm = parseInt($("#rangeKm").val());
		$("#rangeKmVal").text(rangeKmMin + " km" +  " - " + rangeKm + "km");
		var car_info = $(".car_info");
	  $(".car_km").each(function(){
				var car_km = parseInt($(this).text());
				if(car_km <= rangeKm){ 
						//si oui, on choisi le prix
			priceChoice();
			yearChoice();
				}else if(car_km > rangeKm){	
					$(this).parent().css("display", "none");
							$("#rangeKm").on("input", function(){
								$(".car_km").css("display", "block");
								$(".car_info").css("display", "block");
									priceChoice();
									yearChoice();
									
							});
				}else{ alert("Pas de voiture avec ces paramètres");	}
				}); 
 }
	 


function priceChoice(){
$("#rangePrice").on("input", function(){
						var rangePrice = parseInt($("#rangePrice").val());
							$("#rangePriceVal").text(rangePriceMin + "€" +  " - " + rangePrice + "€");
						var car_info = $(".car_info");
						$(".car_price").each(function(){
						var car_price = parseInt($(this).text());
								if(car_price <= rangePrice){ 
								}else if(car_price > rangePrice){
									$(this).parent().css("display", "none");
										$("#rangePrice").on("input", function(){
											$(".car_price").css("display", "block");
											$(".car_info").css("display", "block");
												priceChoice();
												yearChoice();
												
													});
								}else{
									console.log("Pas de proposition avec ce prix");
							}
				}); 
 });
}

function yearChoice(){
$("#rangeYear").on("input", function(){
						var rangeYear = parseInt($("#rangeYear").val());
						$("#rangeYearVal").text(rangeYearMin +  " - " + rangeYear);
						var car_info = $(".car_info");
						$(".car_year").each(function(){
						var car_year = parseInt($(this).text());
								if(car_year <= rangeYear){ 
								}else if(car_year > rangeYear){
								$(this).parent().css("display", "none");
										$("#rangeYear").on("input", function(){
											$(".car_year").css("display", "block");
									  	$(".car_info").css("display", "block"); 
									yearChoice();
								
										});
								
								}else{
									console.log("Pas de propositions");
							}
				}); 
 });
 
}

$("#kmReload").on("input", function(){
location.reload(true);
});
$("#priceReload").on("input", function(){	
	location.reload(true);
});						
$("#yearReload").on("input", function(){
	location.reload(true);
});

$("#rangeKm").on("change", kmChoice);
$("#rangePrice").on("change", priceChoice);
$("#rangeYear").on("change", yearChoice);


$(".btn_reload").input(function () {
location.reload(true);
});

});

</script>

{% endblock %}